# WEAV-AI 테스트 로드맵

이 문서는 구조 변경 후 바로 확인해야 할 최소 테스트 절차를 단계별로 정리한 가이드다.
로컬 환경 기준이며 외부 공개는 비활성화 상태를 기준으로 한다.

---

## 1. 인프라 기본 확인

```bash
cd infra
docker compose up -d --build
```

정상 기동 확인

```bash
docker compose ps
curl http://localhost:8080/healthz
curl http://localhost:8080/api/v1/health/
```

기대 결과
- `healthz`는 `ok` 문자열 반환
- `api/v1/health`는 status가 `healthy`

---

## 2. 백엔드 기본 테스트

마이그레이션

```bash
cd infra
docker compose run --rm -v "$(pwd)/../backend:/app" --entrypoint "" api python manage.py migrate
```

로그 확인

```bash
cd infra
docker compose logs -f api
```

---

## 3. 프론트엔드 실행 테스트

```bash
cd frontend
npm install
npm run dev
```

브라우저 접속
- `http://localhost:3000`

---

## 4. 인증 테스트

1) 구글 로그인 시도
2) 로그인 후 토큰 발급 확인

확인 방법
- 브라우저 네트워크 탭에서 `/api/v1/auth/verify-firebase-token/` 호출 성공 확인
- 로컬 스토리지에 JWT 토큰 저장 여부 확인

---

## 5. 핵심 기능 테스트 (목표 입력 → 계획 → 생성 → 저장)

1) 목표 입력
2) 계획 생성 결과가 화면에 표시되는지 확인
3) 텍스트/이미지/비디오 중 하나 생성 요청
4) 작업 목록에서 상태가 갱신되는지 확인
5) 완료된 결과가 DB에 저장되는지 확인

데이터 확인

```bash
cd infra
docker compose exec postgres psql -U weavai_user -d weavai -c "select count(*) from jobs_job;"
docker compose exec postgres psql -U weavai_user -d weavai -c "select count(*) from jobs_artifact;"
```

---

## 6. 파일 스토리지 테스트 (이미지/비디오)

MinIO 콘솔 확인
- `http://localhost:9001`

버킷 내 오브젝트가 저장되는지 확인

---

## 7. 장애 복구 기본 확인

컨테이너 재시작 후 자동 복구 확인

```bash
cd infra
docker compose restart
curl http://localhost:8080/healthz
```

---

## 8. 환경 토글 확인

`infra/.env`에서 아래 토글을 변경해 동작 확인
- `ENABLE_EXTERNAL_ACCESS`
- `ENABLE_BILLING`
- `ENFORCE_MEMBERSHIP`

변경 후 재기동

```bash
cd infra
docker compose up -d
```

---

## 테스트 환경변수 체크리스트

`infra/.env`
- `SECRET_KEY`
- `POSTGRES_PASSWORD`
- `FAL_KEY`
- `FIREBASE_SERVICE_ACCOUNT_KEY_PATH`

`frontend/.env`
- `VITE_API_BASE_URL`
- `VITE_FIREBASE_API_KEY`
- `VITE_FIREBASE_AUTH_DOMAIN`
- `VITE_FIREBASE_PROJECT_ID`
- `VITE_FIREBASE_STORAGE_BUCKET`
- `VITE_FIREBASE_MESSAGING_SENDER_ID`
- `VITE_FIREBASE_APP_ID`

`backend/.env`는 Docker 기반 테스트에서는 필수 아님.
