# WEAV-AI 빠른 시작 가이드

이 문서는 프로젝트 구조와 인프라를 모르는 사람도 바로 실행할 수 있도록 단계별로 정리한 실행 가이드다.
현재 설정은 외부 공개와 결제 기능이 기본 비활성화되어 있으며, 로컬 개발 기준으로 작성되어 있다.

---

## 0. 사전 준비

필요한 도구
- Docker Desktop
- Node.js 18 이상
- Git

필요한 계정 및 키
- Firebase 프로젝트(구글 로그인용)
- fal.ai API Key (필수)

---

## 1. 저장소 클론 및 진입

```bash
git clone <your-repo-url>
cd WEAV-AI
```

---

## 2. 백엔드 및 인프라 환경 변수 설정

`infra/.env` 파일을 생성한다.

```bash
cp infra/.env.example infra/.env
```

`infra/.env`에서 아래 항목을 반드시 채운다.

- `SECRET_KEY`
- `POSTGRES_PASSWORD`
- `FAL_KEY`
- `FIREBASE_SERVICE_ACCOUNT_KEY_PATH`

외장하드가 연결되어 있다면 다음 경로를 그대로 사용한다.

- `MINIO_DATA_DIR=/Volumes/WEAVAI_2T/minio-data`

---

## 3. 인프라 서비스 실행

```bash
cd infra
docker compose up -d --build
```

실행 확인

```bash
docker compose ps
curl http://localhost:8080/healthz
curl http://localhost:8080/api/v1/health/
```

---

## 4. 데이터베이스 마이그레이션

```bash
cd infra
docker compose run --rm -v "$(pwd)/../backend:/app" --entrypoint "" api python manage.py migrate
```

---

## 5. 프론트엔드 환경 변수 설정

`frontend/.env` 파일을 생성한다.

```bash
cd frontend
cp .env.example .env
```

`frontend/.env`에서 Firebase 관련 항목을 채운다.

- `VITE_FIREBASE_API_KEY`
- `VITE_FIREBASE_AUTH_DOMAIN`
- `VITE_FIREBASE_PROJECT_ID`
- `VITE_FIREBASE_STORAGE_BUCKET`
- `VITE_FIREBASE_MESSAGING_SENDER_ID`
- `VITE_FIREBASE_APP_ID`

로컬 개발 시 API는 기본값으로 사용한다.

- `VITE_API_BASE_URL=http://localhost:8080`

---

## 테스트용 환경변수 요약

로컬 테스트 기준에서 반드시 채워야 하는 항목만 정리한다.

`infra/.env`
- `SECRET_KEY`
- `POSTGRES_PASSWORD`
- `FAL_KEY`
- `FIREBASE_SERVICE_ACCOUNT_KEY_PATH` (Google 로그인 테스트 시 필수)

`frontend/.env`
- `VITE_API_BASE_URL`
- `VITE_FIREBASE_API_KEY`
- `VITE_FIREBASE_AUTH_DOMAIN`
- `VITE_FIREBASE_PROJECT_ID`
- `VITE_FIREBASE_STORAGE_BUCKET`
- `VITE_FIREBASE_MESSAGING_SENDER_ID`
- `VITE_FIREBASE_APP_ID`

`backend/.env`는 로컬에서 Django를 직접 실행할 때만 필요하며, Docker 기반 테스트에서는 필수 아님.

---

## 6. 프론트엔드 실행

```bash
cd frontend
npm install
npm run dev
```

브라우저에서 접속

- `http://localhost:3000`

---

## 7. 기본 동작 확인

1) 구글 로그인
2) 채팅 또는 작업 생성
3) 결과가 저장되는지 확인

서버 로그 확인

```bash
cd infra
docker compose logs -f api
```

---

## 8. 개발 모드 기본 정책

현재 기본값은 개발 편의를 위해 다음 기능이 비활성화되어 있다.

- 외부 공개(Cloudflare Tunnel)
- 결제 및 멤버십 강제

필요 시 아래 설정을 바꿔서 활성화할 수 있다.

`infra/.env`
- `ENABLE_EXTERNAL_ACCESS=true`
- `ENABLE_BILLING=true`
- `ENFORCE_MEMBERSHIP=true`

---

## 9. 문제 해결 체크리스트

- `healthz`가 실패하면 Nginx 또는 Docker가 올라오지 않은 상태
- `api/v1/health`가 실패하면 Django 또는 DB 연결 문제
- 로그인 실패 시 Firebase 설정 확인
- 이미지/비디오 생성 실패 시 FAL 키 또는 모델 엔드포인트 설정 확인

---

## 참고 문서

- `docs/프로젝트_문서.md`
- `docs/개발_로드맵.md`
- `infra/README.md`
